# Glassfish5 with Oracke JDK
build:
  box: shinya/docker-mvn
  steps:
    - script:
        name: maven package
        code: |
          pwd
          ls -l
          cd maven/servlet4-serverpush/
          pwd
          ls -l
          mvn clean package
deploy-glassfish:
# Glassfish5 with Oracke JDK
deploy-glassfish:
  box: shinya/docker-glassfish5
  steps:
    - script:
        code: |
          echo "[ENVIRONMENT VARIABLE]"
          env
          echo "[PRINT WORKING DIRECTORY]"
          pwd
          echo "ls -l"
          ls -l
          echo "ls -l $WERCKER_SOURCE_DIR"
          ls -l $WERCKER_SOURCE_DIR
          echo "ls -l $WERCKER_SOURCE_DIR/maven/servlet4-serverpush/target/"
          ls -l $WERCKER_SOURCE_DIR/maven/servlet4-serverpush/target/
          count=0
          while [ $count -lt 100 ]; do tmp_str=`lsof -i:4848`; if [ "$tmp_str" != "" ]; then echo "Glassfish started"; break; fi; count=`expr $count + 1`; echo "Waiting..."; sleep 1; done
          asadmin deploy $WERCKER_SOURCE_DIR/maven/servlet4-serverpush/target/serverpush.war
